<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Antibody Search</title>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
              rel="stylesheet">
    </head>
    <body>
        <div class="container mt-5">
            <h1 class="text-center">Antibody Search</h1>

            <form method="GET" action="/">
                <div class="input-group mb-4">
                    <input type="text"
                           name="query"
                           class="form-control"
                           placeholder="Search antibodies by ID or type"
                           value="{{ antibodies_query }}">
                    <button class="btn btn-primary" type="submit">Search</button>
                </div>
            </form>

            <div class="row row-cols-1 row-cols-md-3 g-4">
                {% for antibody in antibodies_list %}
                    <div class="col">
                        <div class="card">

                            <img src="/compound-image?smiles=id={{ antibody.id }}"
                                 class="card-img-top"
                                 alt="{{ antibody.id }}">

                            <div class="card-body">
                                {% set styled_chars = [] %}

                                {% for i in range(antibody.sequence|length) %}
                                    {% if i in highlights[0] %}
                                        {% set _ = styled_chars.append("<span style='color: red;'>" + antibody.sequence[i] + "</span>") %}
                                    {% else %}
                                        {% set _ = styled_chars.append("<span style='color: black;'>" + antibody.sequence[i] + "</span>") %}
                                    {% endif %}
                                {% endfor %}

                                {% set sequence_html = "".join(styled_chars) %}

                                <h5 class="card-title"
                                    data-bs-toggle="tooltip"
                                    data-bs-html="true"
                                    title="<strong>Type:</strong> {{ antibody.type }}<br><strong>Sequence:</strong> {{ sequence_html | safe }}">
                                    {{ antibody.id }} - {{ antibody.type }}
                                </h5>

                                <p>{{ sequence_html | safe }}</p>
                            </div>
                        </div>
                    </div>
                {% endfor %}
            </div>
        </div>

        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
        <script>

        const tooltipTriggerList = document.querySelectorAll('[data-bs-toggle="tooltip"]');
        tooltipTriggerList.forEach(function (tooltipTriggerEl) {
            new bootstrap.Tooltip(tooltipTriggerEl);
        });
        </script>
    </body>
</html>
